import { useEffect, useState } from 'react';
import { useEventCallback } from '../../../../hooks';
export const useExpandable = expandable => {
  const [expandedRows, setExpandedRows] = useState({});
  const isExpandable = Boolean(expandable);
  const expandedItemsEventCallback = useEventCallback(parentRowId => {
    if (!expandable || parentRowId === null) {
      return;
    }
    const {
      onExpandedChange
    } = expandable;
    const isExpandedRow = expandedRows[parentRowId] !== undefined;
    if (isExpandedRow) {
      const newExpandedRows = Object.entries(expandedRows).filter(_ref => {
        let [key] = _ref;
        return key !== `${parentRowId}`;
      });
      onExpandedChange(Object.fromEntries(newExpandedRows), parentRowId);
    } else {
      const newExpandedRows = {
        ...expandedRows
      };
      newExpandedRows[parentRowId] = true;
      onExpandedChange(newExpandedRows, parentRowId);
    }
  });
  useEffect(() => {
    if (expandable?.expandedRows) {
      setExpandedRows({
        ...expandable.expandedRows
      });
    }
  }, [expandable?.expandedRows]);
  return {
    expandedRows,
    getChildren: expandable?.getChildren,
    isExpandable,
    onExpandedRow: isExpandable ? expandedItemsEventCallback : undefined,
    setExpandedRows
  };
};